<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/dragAndDrop.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/dragAndDrop.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview
 * @namespace dragAndDrop
 * @description Implements drag-and-drop functionality for tasks in a Kanban board.
 * Allows users to move tasks between different columns with visual feedback.
 * Updates the task's category in the Firebase database upon dropping.
 */

let draggedTask = null;

/**
 * @function startDrag
 * @memberof dragAndDrop
 * @description Initiates the drag operation for a task.
 * @param {*} event 
 * @param {Task} task 
 * @return {void}
 */
function startDrag(event, task) {
    draggedTask = task;
    setTimeout(() => {
        task.classList.add('dragging');
        const currentColumnId = getCurrentColumnId(task);
        hideAllDropzones();
        showAllowedDropzones(getAllowedColumns(currentColumnId));
    }, 0);
}

/**
 * @function getCurrentColumnId
 * @memberof dragAndDrop
 * @description Gets the ID of the current column for a task.
 * @param {Task} task 
 * @returns {string} The ID of the current column.
 */
function getCurrentColumnId(task) {
    const currentColumn = task.closest('[data-role="kanban-column"], .kanban-column, .kanban-column-mobile');
    return currentColumn ? (currentColumn.id || currentColumn.dataset.column || '') : '';
}

/**
 * @function hideAllDropzones
 * @memberof dragAndDrop
 * @description Hides all drop zones in the Kanban board.
 * @return {void}
 */
function hideAllDropzones() {
    document.querySelectorAll('[data-role="kanban-dropzone"], .kanban-dropzone, .kanban-dropzone-mobile').forEach(dropzone => {
        dropzone.classList.remove('show-dropzone');
        dropzone.style.opacity = '0';
        dropzone.classList.add('d-none');
    });
}

/**
 * @function getAllowedColumns
 * @memberof dragAndDrop
 * @description Gets the allowed columns for a task based on its current column.
 * @param {string} currentColumnId - The ID of the current column.
 * @returns {Array&lt;string>} The array of allowed column IDs.
 */
function getAllowedColumns(currentColumnId) {
    const allowed = {
        todo: ['inprogress'],
        inprogress: ['todo', 'awaiting'],
        awaiting: ['inprogress', 'done'],
        done: ['awaiting', 'inprogress']
    };
    return allowed[currentColumnId] ? allowed[currentColumnId] : [];
}

/**
 * @function showAllowedDropzones
 * @memberof dragAndDrop
 * @description Shows the allowed dropzones for a task being dragged.
 * @param {Array&lt;string>} allowedColumns - The array of allowed column IDs.
 * @return {void}
 */
function showAllowedDropzones(allowedColumns) {
    allowedColumns.forEach(colId => {
        const col = document.getElementById(colId) || document.querySelector(`[data-role="kanban-column"][data-column="${colId}"]`);
        if (col) {
            const dropzone = col.querySelector('[data-role="kanban-dropzone"], .kanban-dropzone, .kanban-dropzone-mobile');
            if (dropzone) {
                dropzone.style.opacity = '1';
                dropzone.classList.remove('d-none');
            };
        }
    });
}

/**
 * @function endDrag
 * @memberof dragAndDrop
 * @description Ends the drag operation for a task.
 * @param {Task} task - The task being dragged.
 * @return {void}
 */
function endDrag(task) {
    task.classList.remove('dragging');
    draggedTask = null;
    document.querySelectorAll('[data-role="kanban-dropzone"], .kanban-dropzone, .kanban-dropzone-mobile').forEach(dropzone => {
        dropzone.style.opacity = '0';
        dropzone.classList.add('d-none');
    });
}

/**
 * @function dropTask
 * @memberof dragAndDrop
 * @description Handles the drop event for a task.
 * @param {DragEvent} event - The drag event.
 * @param {HTMLElement} column - The column element where the task is dropped.
 * @return {Promise&lt;void>}
 */
async function dropTask(event, column) {
    column.classList.remove('over');
    if (draggedTask) {
        let dropzone = column.querySelector('[data-role="kanban-dropzone"], .kanban-dropzone, .kanban-dropzone-mobile');
        const tasksContainer = column.querySelector('[data-role="kanban-tasks"], .kanban-tasks, .kanban-tasks-mobile');
        (tasksContainer || column).insertBefore(draggedTask, dropzone);
        const newCategory = column.id || column.dataset.column;
        const taskId = draggedTask.getAttribute('id') || draggedTask.dataset.taskId;
        const fb = new FirebaseDatabase();
        await fb.getFirebaseLogin(() => fb.updateData(`tasks/${taskId}`, { taskStateCategory: newCategory }));
        updateBtnAfterMovingTask(taskId, newCategory);
    }
    toggleNoTaskVisible();
}

/**
 * @function moveTaskToCategory
 * @memberof dragAndDrop
 * @description Moves a task to a new category.
 * @param {string} taskId - The ID of the task to move.
 * @param {string} newCategory - The new category to move the task to.
 * @returns {Promise&lt;void>}
 */
async function moveTaskToCategory(taskId, newCategory) {
    if (!taskId) return console.error('Task ID is null oder undefined.');
    newCategory = rewriteCategory(newCategory);
    const fb = new FirebaseDatabase();
    await fb.getFirebaseLogin(() => fb.updateData(`tasks/${taskId}`, { taskStateCategory: newCategory }));
    moveTaskInDom(taskId, newCategory);
    updateBtnAfterMovingTask(taskId, newCategory);
    getBoardTasks();
}

/**
 * @function rewriteCategory
 * @memberof dragAndDrop
 * @description Rewrites the category name to a standardized format.
 * @param {string} cat - The category name to rewrite.
 * @returns {string} The rewritten category name.
 */
function rewriteCategory(cat) {
    return cat === 'To-Do' ? 'todo' :
        cat === 'In progress' ? 'inprogress' :
            cat === 'Awaiting feedback' ? 'awaiting' :
                cat === 'Done' ? 'done' : '';
}

/**
 * @function moveTaskInDom
 * @memberof dragAndDrop
 * @description Moves a task in the DOM to a new category.
 * @param {string} taskId - The ID of the task to move.
 * @param {string} newCategory - The new category to move the task to.
 * @return {void}
 */
function moveTaskInDom(taskId, newCategory) {
    const task = document.getElementById(taskId);
    const col = document.getElementById(newCategory) || document.querySelector(`[data-column="${newCategory}"]`);
    if (task &amp;&amp; col) {
        const tasks = col.querySelector('[data-role="kanban-tasks"], .kanban-tasks, .kanban-tasks-mobile');
        const dropzone = col.querySelector('[data-role="kanban-dropzone"], .kanban-dropzone, .kanban-dropzone-mobile');
        if (tasks &amp;&amp; dropzone) tasks.insertBefore(task, dropzone);
    }
}

/**
 * @function updateBtnAfterMovingTask
 * @memberof dragAndDrop
 * @description Updates the button states after moving a task.
 * @param {string} taskId - The ID of the task that was moved.
 * @param {string} newCategory - The new category of the task.
 * @return {void}
 */
function updateBtnAfterMovingTask(taskId, newCategory) {
    const swapMenu = document.getElementById(`swap-mobile-menu-${taskId}`);
    const { prev: prevCategory, next: nextCategory } = getPrevAndNextCategory(newCategory);
    swapMenu.innerHTML = '';
    swapMenu.innerHTML += getBtnTemplateAfterMovingTask(taskId, prevCategory, nextCategory);
}

/**
 * @function getPrevAndNextCategory
 * @memberof dragAndDrop
 * @description Gets the previous and next category for a given category.
 * @param {string} category - The current category.
 * @returns {{ prev: string, next: string }} The previous and next categories.
 */
function getPrevAndNextCategory(category) {
    return category === 'todo' ? { prev: '', next: ' In progress' } :
        category === 'inprogress' ? { prev: 'To-Do', next: 'Awaiting feedback' } :
            category === 'awaiting' ? { prev: 'In progress', next: 'Done' } :
                category === 'done' ? { prev: 'Awaiting feedback', next: '' } : '';
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-scripts_firebase.html">scripts/firebase</a></li></ul><h3>Namespaces</h3><ul><li><a href="addEditContacts.html">addEditContacts</a></li><li><a href="addTaskTemplate.html">addTaskTemplate</a></li><li><a href="app.html">app</a></li><li><a href="board.html">board</a></li><li><a href="boardTaskTemplate.html">boardTaskTemplate</a></li><li><a href="contactTemplates.html">contactTemplates</a></li><li><a href="contacts.html">contacts</a></li><li><a href="dragAndDrop.html">dragAndDrop</a></li><li><a href="greeting.html">greeting</a></li><li><a href="help.html">help</a></li><li><a href="landscapeBlock.html">landscapeBlock</a></li><li><a href="login.html">login</a></li><li><a href="navigations.html">navigations</a></li><li><a href="openCloseDialog.html">openCloseDialog</a></li><li><a href="privacyLegal.html">privacyLegal</a></li><li><a href="script.html">script</a></li><li><a href="summary.html">summary</a></li></ul><h3>Classes</h3><ul><li><a href="AddTaskMobileUtil.html">AddTaskMobileUtil</a></li><li><a href="AddTaskUtils.html">AddTaskUtils</a></li><li><a href="BoardTaskDetailDeleteUtil.html">BoardTaskDetailDeleteUtil</a></li><li><a href="BoardTaskDetailEditUtils.html">BoardTaskDetailEditUtils</a></li><li><a href="BoardTaskDetailViewUtils.html">BoardTaskDetailViewUtils</a></li><li><a href="Contact.html">Contact</a></li><li><a href="ContactAssigned.html">ContactAssigned</a></li><li><a href="CreateNewTask.html">CreateNewTask</a></li><li><a href="DueDateCheck.html">DueDateCheck</a></li><li><a href="EditTaskSafeUtil.html">EditTaskSafeUtil</a></li><li><a href="FirebaseDatabase.html">FirebaseDatabase</a></li><li><a href="Subtask.html">Subtask</a></li><li><a href="SubtaskToTask.html">SubtaskToTask</a></li><li><a href="Task.html">Task</a></li><li><a href="TaskComponents.html">TaskComponents</a></li><li><a href="TaskElements.html">TaskElements</a></li></ul><h3>Global</h3><ul><li><a href="global.html#firebaseConfig">firebaseConfig</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue Oct 28 2025 21:36:38 GMT+0100 (Mitteleurop√§ische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
