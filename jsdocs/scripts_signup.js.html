<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/signup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/signup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview
 * @namespace signup
 * @description This script manages the sign-up page functionality, including form validation,
 * user data handling, and navigation to the login page upon successful sign-up.
 * It includes functions to validate input fields, handle form submission,
 * and provide user feedback on errors.
 * @file scripts/signup.js
 */


const namePattern = /\w{3,10}\s\w{3,10}/;
const emailPattern = /^(?!.*\.\.)(?!\.)(?!.*\.$)[A-Za-z0-9!#$%&amp;'*+/=?^_`{|}~.-]+@(?:(?!-)[A-Za-z0-9-]{1,63}(?&lt;!-)\.)+[A-Za-z]{2,}$/i;
let nameIsOnInput = false;
let emailIsOnInput = false;
let passwordIsOnInput = false;
let passwordConfirmIsOnInput = false;

/**
 * @function signupinit
 * @memberof signup
 * @description Initialize the signup page.
 * @returns {Promise&lt;void>}
 */
async function signupinit() {
    let logInStatus = getLogStatus();
    if (logInStatus !== "0") {
        navigateToLogin();
    }

}

/**
 * @function signInFieldOnBlur
 * @memberof signup
 * @description Handle onBlur event for sign-in fields.
 * @param {HTMLInputElement} input
 * @returns {void}
 */
function signInFieldOnBlur(input) {
    if (!input) { return; }

    if (input.id) {
        eval(`validate${input.id}()`);
    }
}

/**
 * @function signInFieldsOnInput
 * @memberof signup
 * @description Handle onInput event for sign-in fields.
 * @param {HTMLInputElement} input
 * @returns {void}
 */
function signInFieldsOnInput(input) {
    if (!input) { return; }
    hideErrorTextOfInputField(input.id);
}

/**
 * Hide the error text of the input field.
 * @function hideErrorTextOfInputField
 * @memberof signup
 * @description Hide the error text of the input field.
 * @param {string} inputFieldID
 * @returns {void}
 */
function hideErrorTextOfInputField(inputFieldID){
    const errorTextElements = document.querySelectorAll('.login-signup-error-text-container p');
    if(!errorTextElements.length){return;}
    const errorTextElement = Array.from(errorTextElements).find(x => x.getAttribute('data-input') == inputFieldID);
    if(!errorTextElement){return;}
    errorTextElement.classList.add('d-none');
}

/**
 * @function validatefullname
 * @memberof signup
 * @description Validate the full name field.
 * @returns {Boolean}
 */
function validatefullname() {
    if (!nameIsOnInput) { return; }
    const nameElement = document.getElementById('fullname');
    if (!nameElement) { return; }
    const cleanNameValue = (nameElement.value ?? "").trim();
    if (cleanNameValue.length >= 3 &amp;&amp; namePattern.test(cleanNameValue)) {
        setInputFieldHasNoError(nameElement.id, "name-error-text");
        return true;
    } else {
        setInputFieldHasError(nameElement.id, "name-error-text",  "First and last name are required.");
        return false;
    }
}

/**
 * @function validateemail
 * @memberof signup
 * @description Validate the email field.
 * @returns {Boolean}
 */
async function validateemail() {
    if (!emailIsOnInput) { return; }
    const emailElement = document.getElementById('email');
    if (!emailElement) { return; }
    const cleanEmailValue = (emailElement.value ?? "").trim();
    if (cleanEmailValue.length >= 3 &amp;&amp; emailValidator(cleanEmailValue) &amp;&amp; !await checkEmailInDatabase(cleanEmailValue)) {
        setInputFieldHasNoError(emailElement.id, "email-error-text");
        return true;
    } else if (await checkEmailInDatabase(cleanEmailValue)) {
        setInputFieldHasError(emailElement.id, "email-error-text", "Email is already in use.");
        return false;
    } else {
        setInputFieldHasError(emailElement.id, "email-error-text", "Not a valid email address.");
        return false;
    }
}

/**
 * Checks if the provided email is valid according to RFC standards.
 * Validates length, format, and domain rules.
 * @function emailValidator
 * @memberof signup
 * @description Validate email format according to RFC standards.
 * @param {string} email
 * @returns {boolean}
 */
function emailValidator(email) {
    if (email.length > 254) { return false; }
    if (/\.{2,}/.test(email)) { return false; }
    if (!emailPattern.test(email)) { return false; }
    const [local, domain] = email.split('@');
    if (!local || !domain) return false;
    if (local.length > 64) return false;
    if (domain.startsWith('-') || domain.endsWith('-')) return false;
    if (domain.split('.').some(part => !part || part.length > 63)) return false;
    return true;
}

/**
 * @function validatepasswordConfirm
 * @memberof signup
 * @description Validate the password confirmation field.
 * @returns {Boolean}
 */
function validatepasswordConfirm() {
    if(!passwordIsOnInput || !passwordConfirmIsOnInput) { return; }
    const passwordElement = document.getElementById('password');
    const passwordConfirmElement = document.getElementById('passwordConfirm');
    if (!passwordElement || !passwordConfirmElement) { return; }


    if(passwordConfirmElement.value.length &lt;= 3){
        setInputFieldHasError(passwordConfirmElement.id, "login-confirm-error-text", "The password is too short.");
    } 
    else if (passwordElement.value === passwordConfirmElement.value) {
        setInputFieldHasNoError(passwordConfirmElement.id, "login-confirm-error-text");
        return true;
    }
    else {
        setInputFieldHasError(passwordConfirmElement.id, "login-confirm-error-text", "Your passwords don't match. Please try again.");
        return false;
    }
}

/**
 * @function validatepassword
 * @memberof signup
 * @description Validate the password field.
 * @returns {Boolean}
 */
function validatepassword() {
    if (!passwordIsOnInput) { return; }
    const passwordElement = document.getElementById('password');
    if (!passwordElement) { return; }
    if (passwordElement.value.length &lt;= 3) {
        setInputFieldHasError(passwordElement.id, "login-error-text", "The password is too short.");
        return false;
    } else {
        setInputFieldHasNoError(passwordElement.id, "login-error-text");
        return true;
    }
}

/**
 * @function validatePolicyAccept
 * @memberof signup
 * @description Validate the policy acceptance checkbox.
 * @returns {Boolean}
 */
function validatePolicyAccept() {
    const confirmCheckbox = document.getElementById('signupConfirm');
    if (!confirmCheckbox) { return; }
    return confirmCheckbox.checked;
}

/**
 * @function splitNameToFirstLastAndInitial
 * @memberof signup
 * @description Get first name, last name and initials from full name.
 * @param {FormData} signUp - The form data from the sign-up form.
 * @returns {Object} - An object containing the first name, last name, and initials.
 */
function splitNameToFirstLastAndInitial(signUp) {
    let fullName = signUp.get("fullname").trim();
    let parts = fullName.split(/\s+/);
    let lastname = parts.pop();
    let firstname = parts.join(" ");
    let cap = s => s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();
    firstname = firstname.split(" ").map(cap).join(" ");
    lastname = cap(lastname);
    let initial = firstname.charAt(0).toUpperCase() + lastname.charAt(0).toUpperCase();
    return { firstname, lastname, initial };
}

/**
 * @function checkEmailInDatabase
 * @memberof signup
 * @description Check if the email exists in the database.
 * @param {string} email
 * @returns {Promise&lt;boolean>}
 */
async function checkEmailInDatabase(email) {
    let fb = new FirebaseDatabase();
    let found = await fb.getFirebaseLogin(() => fb.getDataByKey("email", email, "contacts"));
    return found ? true : false;
}

/**
 * @function setInputFieldHasNoError
 * @memberof signup
 * @description Set the input field to a valid state (no error).
 * @param {String} elementID
 * @returns {void}
 */
function setInputFieldHasNoError(elementID, errorTextID) {
    toggleBorderColorByError(elementID, true);
    const errorElement = document.getElementById(errorTextID);
    if (errorElement) {
        errorElement.textContent = "";
        errorElement.classList.add("d-none");
    }
}

/**
 * @function setInputFieldHasError
 * @memberof signup
 * @description Set the input field to an invalid state (error).
 * @param {String} elementID
 * @param {String} message
 * @returns {void}
 */
function setInputFieldHasError(elementID, errorTextID, message) {
    toggleBorderColorByError(elementID, false);
    const errorElement = document.getElementById(errorTextID);
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.classList.remove("d-none");
    }
}


/**
 * @function signUpForm
 * @memberof signup
 * @description Handle the sign-up form submission.
 * Safes the user data to the database and signs in the user.
 * @param {Event} event
 * @returns {Promise&lt;void>}
 */
async function signUpForm(event) {
    event.preventDefault();
    let signUp = new FormData(event.target);
    if (!checkAllRequiredField()) { return; }
    const { firstname, lastname, initial } = splitNameToFirstLastAndInitial(signUp);
    const fb = new FirebaseDatabase();
    if (!fb.createNewSignedUser(null, firstname, lastname, signUp.get('password'), signUp.get('email'), null, initial, null)) { return; }
    signInAfterSafe();
}

/**
 * @function signupMouseUp
 * @memberof signup
 * @description Handle the mouse up event on the sign-up button.
 * @param {MouseEvent} event
 * @returns {void}
 */
function signupMouseUp(event) {
    const button = document.getElementById('signup-button');
    if (!button) { return; }
    if (event.target == button) {
        leaveFocusOffAllFields();
        button.disabled = !(checkAllRequiredField());
    }
}

/**
 * @function leaveFocusOffAllFields
 * @memberof signup
 * @description Remove focus from all input fields.
 * @return {void}
 */
function leaveFocusOffAllFields() {
    const inputElements = document.querySelectorAll("input");
    inputElements.forEach((input) => {
        input.blur();
    });
}

/**
 * @function checkAllRequiredField
 * @memberof signup
 * @description Check all required fields for validity.
 * @returns {boolean}
 */
function checkAllRequiredField() {
    const isNameVal = validatefullname();
    const isMailVal = validateemail();
    const isPwdVal = validatepassword();
    const isPwdConfirmVal = validatepasswordConfirm();
    const isPolicyConfirmVal = validatePolicyAccept();
    return isNameVal &amp;&amp; isMailVal &amp;&amp; isPwdVal &amp;&amp; isPwdConfirmVal &amp;&amp; isPolicyConfirmVal;
}

/**
 * @function signInAfterSafe
 * @memberof signup
 * @description Show a dialog indicating successful sign-up and navigate to login page.
 * @return {void}
 */
function signInAfterSafe() {
    const dialog = document.getElementById('signUp-safe-dialog');
    dialog.classList.remove('visually-hidden');
    dialog.classList.add('safe-dialog-show');
    dialog.showModal();
    setTimeout(function () {
        dialog.close();
        navigateToLogin();
    }, 1800);
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-scripts_firebase.html">scripts/firebase</a></li></ul><h3>Namespaces</h3><ul><li><a href="addEditContacts.html">addEditContacts</a></li><li><a href="addTaskTemplate.html">addTaskTemplate</a></li><li><a href="app.html">app</a></li><li><a href="board.html">board</a></li><li><a href="boardDatabase.html">boardDatabase</a></li><li><a href="boardDetailView.html">boardDetailView</a></li><li><a href="boardSearch.html">boardSearch</a></li><li><a href="boardTaskTemplate.html">boardTaskTemplate</a></li><li><a href="boardTasks.html">boardTasks</a></li><li><a href="boardUtils.html">boardUtils</a></li><li><a href="contactTemplates.html">contactTemplates</a></li><li><a href="contacts.html">contacts</a></li><li><a href="dragAndDrop.html">dragAndDrop</a></li><li><a href="greeting.html">greeting</a></li><li><a href="help.html">help</a></li><li><a href="landscapeBlock.html">landscapeBlock</a></li><li><a href="login.html">login</a></li><li><a href="navigations.html">navigations</a></li><li><a href="openCloseDialog.html">openCloseDialog</a></li><li><a href="privacyLegal.html">privacyLegal</a></li><li><a href="script.html">script</a></li><li><a href="summary.html">summary</a></li><li><a href="taskComponents_.html">taskComponents</a></li></ul><h3>Classes</h3><ul><li><a href="AddTaskCache.html">AddTaskCache</a></li><li><a href="AddTaskMobileUtil.html">AddTaskMobileUtil</a></li><li><a href="AddTaskUtils.html">AddTaskUtils</a></li><li><a href="BoardTaskDetailDeleteUtil.html">BoardTaskDetailDeleteUtil</a></li><li><a href="BoardTaskDetailEditUtils.html">BoardTaskDetailEditUtils</a></li><li><a href="BoardTaskDetailViewUtils.html">BoardTaskDetailViewUtils</a></li><li><a href="Contact.html">Contact</a></li><li><a href="ContactAssigned.html">ContactAssigned</a></li><li><a href="CreateNewTask.html">CreateNewTask</a></li><li><a href="DueDateCheck.html">DueDateCheck</a></li><li><a href="EditTaskSafeUtil.html">EditTaskSafeUtil</a></li><li><a href="FirebaseDatabase.html">FirebaseDatabase</a></li><li><a href="Subtask.html">Subtask</a></li><li><a href="SubtaskToTask.html">SubtaskToTask</a></li><li><a href="Task.html">Task</a></li><li><a href="TaskComponents.html">TaskComponents</a></li><li><a href="TaskElements.html">TaskElements</a></li></ul><h3>Mixins</h3><ul><li><a href="taskComponents.categories.html">categories</a></li><li><a href="taskComponents.contacts.html">contacts</a></li><li><a href="taskComponents.create.html">create</a></li><li><a href="taskComponents.layout.html">layout</a></li><li><a href="taskComponents.priority.html">priority</a></li><li><a href="taskComponents.subtasks.html">subtasks</a></li><li><a href="taskComponents.validation.html">validation</a></li></ul><h3>Global</h3><ul><li><a href="global.html#firebaseConfig">firebaseConfig</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Nov 10 2025 20:21:08 GMT+0100 (Mitteleurop√§ische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
